# Deploy to Kubernetes

## Add API

- 👉"one" APIM
  - 🖥no APIs
- 👉"httpbin" web app
  - 🖥container
  - 📢new integration with APIM
  - 🖱link and export to APIM
    - suffix: "httpbin"
  - 📢expose only small subset of operations
  - 🖱test each op explaining its function

## Add gateway

- 👉"one" APIM (from the web app)
  - Add gateway
    - ❗name: "gateway"
    - ❗️location: "Seattle"
  - 🖱gateway resource
    - 🖥gateway blades
    - 🖱Deployment
      - ❗token autogenerated using primary key with max expiry
      - 🖥changing key or expiry generates new token

## Deploy gateway

- 👉 VSC
  - 🖥APIM extension
    - 🖥API can be added in VSC
    - 🖥gateway can be added in VSC
    - 🖱set subscriptionRequired to false on httpbin API
    - 🖱rename key header and query to "api-key"
    - 🖱add httpbin API to the "Private" product
  - 🖥Minikube
- 👉 "one" APIM
  - 🖱copy create secret command
  - 🖱download yaml
- 👉 VSC
  - 🖱copy yaml to the 1-/yaml folder
  - 🖱cd into the 1- folder
  - 🖥gateway yaml and explain it
  - 🖱run command to create api-gateway namespace
  - 🖱paste create secret command to the cmd.sh and add api-gateway namespace
  - 🖱run create secret command
  - 🖱run command to deploy gateway into api-gateway namespace
  - 🖥created Kubernetes artifacts
  - 🖱run command to view pod logs
  - 🖱run command to forward service ports
  - 🖱make sure REST-Client is set to use local-api
  - 🖱call an op from REST-Client - 404
  - 🖱add httpbin API to the gateway
  - 🖱call all ops from REST-Client - 200
  - ❗️cloud and local gateways use cloud backend
- 👉"one" APIM
  - 🖥show nodes and status of the gateway

## Add and test rate limit

- 👉 VSC
  - 🖥artillery rate-limit yaml
  - 📢should expect 50 200 OK
  - run artillery
    - ❗️200 - 200 OK
  - 🖱add rate limit to httpbin API in before of base
    - `<rate-limit-by-key calls="10" renewal-period="1" counter-key="@(context.Request.IpAddress)" />`
  - run artillery
    - ❗️50 - 200 OK

## Show telemеtry in Application Insights

- 👉Application Insights
  - 🖥application map
  - 🖥run artillery while showing live metrics

## Legend

- 👉Go
- 🖥Show
- 📢Explain
- ❗️Highlight
- 🖱Click
