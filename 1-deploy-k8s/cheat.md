# Deploy to Kubernetes

## Add API

- 游녤"one" APIM
  - 游둰no APIs
- 游녤"httpbin" web app
  - 游둰container
  - 游닉new integration with APIM
  - 游둼link and export to APIM
    - suffix: "httpbin"
  - 游닉expose only small subset of operations
  - 游둼test each op explaining its function

## Add gateway

- 游녤"one" APIM (from the web app)
  - Add gateway
    - 仇듩ame: "gateway"
    - 仇勇끏ocation: "Seattle"
  - 游둼gateway resource
    - 游둰gateway blades
    - 游둼Deployment
      - 仇듮oken autogenerated using primary key with max expiry
      - 游둰changing key or expiry generates new token

## Deploy gateway

- 游녤 VSC
  - 游둰APIM extension
    - 游둰API can be added in VSC
    - 游둰gateway can be added in VSC
    - 游둼set subscriptionRequired to false on httpbin API
    - 游둼rename key header and query to "api-key"
    - 游둼add httpbin API to the "Private" product
  - 游둰Minikube
- 游녤 "one" APIM
  - 游둼copy create secret command
  - 游둼download yaml
- 游녤 VSC
  - 游둼copy yaml to the 1-/yaml folder
  - 游둼cd into the 1- folder
  - 游둰gateway yaml and explain it
  - 游둼run command to create api-gateway namespace
  - 游둼paste create secret command to the cmd.sh and add api-gateway namespace
  - 游둼run create secret command
  - 游둼run command to deploy gateway into api-gateway namespace
  - 游둰created Kubernetes artifacts
  - 游둼run command to view pod logs
  - 游둼run command to forward service ports
  - 游둼make sure REST-Client is set to use local-api
  - 游둼call an op from REST-Client - 404
  - 游둼add httpbin API to the gateway
  - 游둼call all ops from REST-Client - 200
  - 仇勇끆loud and local gateways use cloud backend
- 游녤"one" APIM
  - 游둰show nodes and status of the gateway

## Add and test rate limit

- 游녤 VSC
  - 游둰artillery rate-limit yaml
  - 游닉should expect 50 200 OK
  - run artillery
    - 仇勇200 - 200 OK
  - 游둼add rate limit to httpbin API in before of base
    - `<rate-limit-by-key calls="10" renewal-period="1" counter-key="@(context.Request.IpAddress)" />`
  - run artillery
    - 仇勇50 - 200 OK

## Show telem햣try in Application Insights

- 游녤Application Insights
  - 游둰application map
  - 游둰run artillery while showing live metrics

## Legend

- 游녤Go
- 游둰Show
- 游닉Explain
- 仇勇뀯ighlight
- 游둼Click
